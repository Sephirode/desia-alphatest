
# Desia_alpha_1.0 기획서 보완본(v0.2)

## I. 기본 게임 로직

### 1) 메인 메뉴

* 1. 게임 시작
* 2. 불러오기
* 3. 랭킹
* 4. 도움말
* 5. 종료 

### 2) 게임 시작: 캐릭터 선택 + 스토리 프레임

* 플레이어블 캐릭터 목록 → 설명/특수능력 표시 → 선택 확정
* 확정 직후 스토리 문단 출력(스토리 텍스트는 사용자가 작성, 코드는 “표시 프레임”만 제공) 

### 3) 전투 외 진행 기본 구조 = “이벤트-선택지-결과”

* 모든 진행은 아래 구조로 통일:

  * [이벤트 문장 출력] → [선택지] → [결과(스탯 변화 / 전투 / 상점 / 퀘스트 등)] 
* 전투가 아닐 때 활성 메뉴(허브 UI):

  * 1. 진행한다(랜덤 인카운터 호출)
  * 2. 스테이터스
  * 3. 인벤토리
  * 4. 장비
  * 5. 게임 저장(여기서 게임 종료도 가능) 
* “뒤로 가기” 선택지는 **모든 메뉴 깊이에서 항상 제공** 

---

## II. 데이터 주도 설계(핵심 원칙)

### 1) 하드코딩 금지 범위

* 스킬/적/소모품/장비/세트효과/특수효과는 전부 **외부 JSON**에서만 정의
* 코드는 “로더 + 검증기 + 실행 엔진”만 담당

### 2) 스킬은 ‘사용자’에 종속되지 않음

* “플레이어 전용/보스 전용 스킬” 같은 분류를 스킬 정의에 박지 않는다.
* 스킬은 **스킬 풀**이고, 실제 사용 가능 여부는 **개체(플레이어/적)가 어떤 스킬을 배정받았는지**로 결정.

### 3) 적은 ‘성장률 기반 템플릿’

* 적 JSON에는 “현재 레벨 스탯”이 아니라:

  * **1레벨 기준 스탯 + 레벨당 성장률(growth)** 을 가진다.
* 등장 시점 레벨에 맞춰 실스탯을 계산:

  * `stat(L) = base_stat + growth*(L - base_level)`

### 4) 스페셜 태그(특수효과) 분리

* “스탯만으로 구현이 어려운 효과”는 스킬/장비에 `special_tags`로 달고,
* 별도 레지스트리(예: specials.json)에서 실행 로직을 매핑한다.
* 목표: 특수공식 난립 방지 + 확장성 확보

---

## III. 전투 시스템

### 1) 전투 진행 페이즈

* 스탠바이 페이즈 → 배틀 페이즈 → 엔드 페이즈 

#### (1) 스탠바이 페이즈

* 각 엔티티 행동 선택:

  * 1. 기본 공격
  * 2. 스킬
  * 3. 도망
  * 4. 아이템 사용 
* 상태이상으로 행동 불발 가능:

  * 예: 마비/혼란 등(확률 기반) 
* 행동 처리 순서:

  * 스피드 내림차순
  * 동률이면: 레벨 > (현재 체력) 순으로 타이브레이크 

#### (2) 배틀 페이즈

* 선택된 명령을 순서대로 실행
* 피해 계산 및 “즉발형” 부가효과(상태이상 부여, 스탯 변경 등) 처리 
* 배틀 페이즈 도중

  * 플레이어 HP 0 → 게임 오버
  * 적 전멸 → 전투 종료

#### (3) 엔드 페이즈

* 도트형 상태이상(독/화상/출혈 등) 처리 
* 엔드 페이즈 결과로도

  * 플레이어 HP 0 → 게임 오버
  * 적 전멸 → 전투 종료

---

### 2) 명중률(스피드 기반) + 실명

* 기본 명중률:

  * 공격자SPD / 피격자SPD < 1 이면 그 값이 명중률
  * 1 이상이면 100% 명중
* 실명(Blind):

  * 명중률을 추가로 감소(최저치 clamp 적용)
* 설계 포인트:

  * “스피드”는 선턴뿐 아니라 **명중 안정성**까지 관여 → 스피드의 전략 가치 상승

---

### 3) 피해 타입 3종

* 물리(physical): 방어력 적용
* 마법(magic): 마법저항력 적용
* 고정(true): 방어/마저 무시하고 HP에 직격(실드는 예외)
* 한 스킬이 “물리+마법+고정”을 **복합으로 가질 수 있음**

---

### 4) 실드(보호막) 규칙(필수)

* 실드는 HP보다 먼저 깎인다.
* 실드는 **방어/마저로 경감되지 않는다**(=들어온 피해량 그대로 감소).
* 처리 순서(개념):

  1. 실드에서 먼저 차감
  2. 남은 피해가 있으면 HP 차감
* 실드는 스킬/장비 효과로 부여/재생 가능

---

### 5) 치명타율(crit)

* 치명타율은 “기본 공격/스킬”에 **+50% 추가 피해**를 부여할 확률 
* 추천 구현:

  * 치명타는 “최종 피해량”에 곱(예: ×1.5)으로 적용
  * 단, 고정(true)은 치명타 적용 여부를 옵션으로(기획 단계에서 스위치 가능)

---

### 6) 피해 감소 공식(현 기획서의 LoL식 공식은 ‘옵션화’)

`기획gpt.txt`에는 LoL식(100/(100+방어))이 들어가 있는데 , 너는 “체력 100 이하 ~ 최종 2000~4000” 스케일을 원했고 LoL식은 초반 체감이 어긋난다고 했었음.

**해결책(기획서 반영 방식):**

* 피해 감소는 “공식 1개 고정”이 아니라, `config.json`에서 선택 가능한 **감소 모델**로 둔다.

  * 모델 A(LoL식): `mult = 100/(100+def)`
  * 모델 B(선형 캡): `mult = clamp(1 - def * k, minMult, 1)`
  * 모델 C(완만한 곡선): `mult = 1/(1 + def*k)`
* 이렇게 해두면, 밸런싱 단계에서 수치 스케일 바뀌어도 공식만 교체/튜닝 가능.

---

### 7) 상태이상 + 등급 저항

* 상태이상 유형: 도트(화상/독/출혈), 행동 방해(빙결/마비/패닉), 명중 방해(실명) 
* 등급 기반 저항/면역:

  * 보스: 패닉 면역(확정)
  * 엘리트 이상: 패닉 확률 감소 등(확정)
* 지속/해제:

  * 일정 턴 후 자연 해제 또는 감소
  * 스킬/소모품으로 해제 가능 

---

### 8) 전투 보상(승리 시)

* 경험치: 처치한 적들의 “경험치 스탯 합”만큼 획득 
* 골드: 얻은 경험치의 80% 
* 드랍: 일정 확률로 적이 착용한 장비 일부 드랍 
* 레벨업:

  * 경험치 요구량을 초과분 처리(초과 경험치 이월)
  * 한번에 여러 레벨 상승 가능 

---

## IV. 스킬 시스템

### 1) 스킬 개념(요약)

* 공격 스킬: 물리/마법/복합/고정 피해를 가할 수 있음 
* 변화 스킬: 버프/디버프/유틸(회복, 실드 부여, 방어 감소, 다음 공격 강화 등) 

### 2) 스킬 수식: “항(term) 기반”이 기본

특수공식을 따로 만들지 말고, 아래처럼 “항 조합”으로 대부분 표현:

* 상수 항: `constant`
* 자기 스탯 항: `self_atk`, `self_sp`, `self_max_hp`, `self_hp`, `self_missing_hp`, `self_mp`, `self_max_mp`, `self_spd`, `self_spent_mp`
* 상대 스탯 항: `target_hp`, `target_max_hp`, `target_missing_hp`, `target_def`, `target_mr`, `target_spd`
* 구성:

  * `value = Σ(term.coef * term.value)`
* 예시(개념):

  * 어벤저(잃은 체력 비례): `self_missing_hp` 항 사용
  * 처형(적 결손 체력 비례): `target_missing_hp` 항 사용
  * 마나 버스트: `mp_cost = all_current_mp` + `self_spent_mp` 항 사용

### 3) 스페셜 태그(스킬/장비 공통)

* “필중”, “즉사”, “상태이상 면역 무시” 같은 것들은 `special_tags`로만 구현
* 태그는 별도 레지스트리에서 정의(추가/삭제 쉬움)

---

## V. 원소(속성) 시스템(전투 적용)

속성: 불/물/공기/흙/번개/아케인/무속성

* 상성/컨셉(요약):

  * 불: 물에 약 + 화상
  * 흙: 물에 약 + 강한 피해/광역 + 일부 패닉
  * 물: 피해 약 + 일부 빙결
  * 공기: 기본 피해 약 + 높은 계수 + 스피드형
  * 번개: 물에 강, 흙에 약 + 마비 + 저코스트 고효율(희귀)
  * 아케인: 약점 없음 + 고비용 고효율(최상위)
* 적용 방식:

  * “원소 상성 배수 테이블”을 config로 관리
  * 상태이상 부여/지속 보정도 챕터 룰/장비 룰로 확장 가능

---

## VI. 전투 외 이벤트(랜덤 인카운터)

* 랜덤 인카운터도 동일한 “이벤트-선택지-결과” 구조 
* 결과는:

  * 스탯 변화
  * 전투 발생
  * 상점/퀘스트 진입
  * 아이템/장비 획득 등

---

## VII. 상점/장비/인벤토리

### 1) 상점

* 소모품/장비 구매·판매
* 판매가는 상점가의 70% 
* 소모품 예:

  * HP/MP 포션
  * 연막탄(도주 보조)
  * 영구 스탯 증가 희귀 아이템 

### 2) 장비 슬롯(기획서 정리)

`기획gpt.txt`에서는 반지 2개 슬롯 , 과거 논의에서는 4개 슬롯도 있었음.
이건 **밸런스에 영향이 커서 “설정값”으로 처리**하는 게 안전하다.

* 기본안: 반지 슬롯 `RING_SLOTS = 2`
* 확장안: 반지 슬롯 `RING_SLOTS = 4` (대신 unique 제한/중첩 제한 필수)

나머지:

* 투구/흉갑/망토/각반/부츠
* 무기: 한손 2, 양손 1(양손이면 다른 무기 불가) 

### 3) 장비 특수효과/세트효과(필수)

* 장비 착용 시 스킬 부여(예: 특정 검 장착 → 스킬 해금)
* 원소 피해 감소, 상태이상 저항/면역 등
* 세트: n피스 착용 시 보너스 + 전투 중 버프 부여
* 구현은 전부 `special_tags`로 통일(장비도 스킬과 같은 태그 실행기 사용)

---

## VIII. 저장/불러오기

* 여러 슬롯 저장
* 저장 데이터(권장):

  * 플레이어 정보(레벨/경험치/스탯/포인트)
  * 현재 HP/MP/실드
  * 인벤토리(아이템/수량)
  * 장비 착용 상태
  * 습득/해금 스킬
  * 현재 챕터/이벤트 진행 플래그
* 도움말 텍스트는 사용자가 작성, 코드는 프레임만 제공 

---

## IX. 랭킹

* 등록 조건: 플레이어 사망 또는 클리어(챕터7) 
* 점수 공식(원문 유지):

  * 처치한 적 수(보스 5n, 엘리트 2n, 미니언 1n)
  * * 소지금
  * * 보유 아이템 가치
  * * 클리어 챕터 수(챕터당 10점, 최대 7챕터) 

---

## X. 챕터 구성(원문 보강 정리)

`기획gpt.txt`의 챕터 구성은 그대로 유지하되, 엔진 관점에서 필요한 “챕터 룰”을 명시적으로 분리해둔다. 

* 챕터 1: 서부 황야(레벨 1~8)

  * 튜토리얼 구간
  * 정예에 한해 마비/패닉 부여 등장
  * 중보스: 고블린 샤먼 / 보스: 고블린 챔피언 
* 챕터 2: 몰락한 왕국(8~20)

  * 마저 대비 소홀하면 피보는 구간
  * 중보스: 스켈레톤 드래곤 or 스톤 골렘 / 보스: 피의 영혼 
* 챕터 3: 숲의 양옥집(~30)

  * 챕터 룰: 회복계열 +10%
  * 중보스: 데스 나이트 / 보스: 뱀파이어 로드 
* 챕터 4: 전설의 유산(~55)

  * 아티팩트 파밍/빌드 확정(전직급 구간)
  * 중보스: 레드 드래곤 / 보스: 에인션트 드래곤 / 히든: 듀자 
* 챕터 5: 둠 이터널(~80)

  * 챕터 룰: 화속 피해 +10%, 수속 피해 +20%, 수속 MP +20%, 화상 지속 +2턴
  * 중보스: 헬 드래곤 / 보스: 사천왕 아스모데우스 
* 챕터 6: 이계의 침략자(~90)

  * 챕터 룰: MP +15%, 스킬 피해 +30%(양날의 검)
  * 중보스: 사천왕 아몬 / 보스: 크림즌 노바 트리니티 
* 챕터 7: 인마대전(~100)

  * 잡몹 없음(전부 보스급급)
  * 중보스: 듀란/콘빅트 / 보스: 마왕 앨리스 / 진최종: 슈미트
  * 슈미트는 “33% 깎고 필중 즉사기 연출로 마무리”라는 연출 규칙 명시 

